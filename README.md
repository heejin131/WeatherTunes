# ğŸŒ¦ï¸ğŸ§ WeatherTunes
- **ë‚ ì”¨ì— ë”°ë¥¸ Spotify ìŒì•… ì¶”ì²œ ì‹œìŠ¤í…œ**

# **ğŸ¯Â ë¶„ì„ ëª©í‘œ**

> ë‚ ì”¨ ë° ê¸°ì˜¨ì— ë”°ë¼ ì‚¬ëŒë“¤ì´ ì–´ë–¤ ìœ í˜•ì˜ ìŒì•…ì„ ì¦ê²¨ ë“£ëŠ”ì§€ ë¶„ì„
í˜„ì¬ ë° ë‚´ì¼ ë‚ ì”¨ì— ë§ëŠ” ìœ í˜•ì˜ ìŒì•… ì¶”ì²œ
> 

(íŠ¹ì • ì¥ë¥´ì— êµ­í•œëœ ê²ƒì´ ì•„ë‹Œ, BPM ìœ„ì£¼ë¡œ ì‹ ë‚˜ëŠ” ê³¡ì¸ì§€ ì•„ë‹Œì§€ íŒë³„)

<br>

# **ğŸ—’ï¸ ìš”ì•½**

- ì¼ë³„ ë‚ ì”¨ ë°ì´í„° ìˆ˜ì§‘
- ì¼ë³„ Spotify ê¸°ì¤€ í•œêµ­ Top 200 ê³¡ ë°ì´í„° ìˆ˜ì§‘
- ìˆ˜ì§‘í•œ ê³¡ì˜ ìƒì„¸ ë°ì´í„°(BPM, Danceability ë“±) ìˆ˜ì§‘
- ìˆ˜ì§‘í•œ ì •ë³´ì—ì„œ í•„ìš”í•œ ì •ë³´ë§Œì„ ì²˜ë¦¬ í›„ ì ì¬
- ì›í•˜ëŠ” ë‚ ì”¨ì— ì‚¬ëŒë“¤ì´ ì¦ê²¨ ë“£ëŠ” ìŒì•…ê³¼ ë¹„ìŠ·í•œ ê³¡ ì¶”ì²œ

<br>

# **ğŸ“š ë‚´ìš©**

### ë°ì´í„° ìˆ˜ì§‘ ê¸°ê°„

`2023-01-01`- `2024-05-31`

### ìˆ˜ì§‘ ë°ì´í„° ëª©ë¡

<details>
<summary> ë‚ ì”¨ ë°ì´í„° </summary>

- ê¸°ìƒì²­ API í—ˆë¸Œ â†’ ì¢…ê´€ê¸°ìƒê´€ì¸¡(ASOS) â†’ ì§€ìƒ ê´€ì¸¡ìë£Œ ì¡°íšŒ
- https://apihub.kma.go.kr/
- API url

```bash
https://apihub.kma.go.kr/api/typ01/url/kma_sfctm3.php?tm1=<YYYYMMDDHHmm>&tm2=<YYYYMMDDHHmm>&stn=108&help=1&authKey=<AUTH_KEY>
```

- ê²°ê³¼

```python
#--------------------------------------------------------------------------------------------------
#  ê¸°ìƒì²­ ì§€ìƒê´€ì¸¡ ì‹œê°„ìë£Œ [ì…ë ¥ì¸ìˆ˜í˜•íƒœ][ì˜ˆ] ?tm=<YYYYMMDDHHmm>&stn=108&help=1
#--------------------------------------------------------------------------------------------------
#  1. TM     : ê´€ì¸¡ì‹œê° (KST)
#  2. STN    : êµ­ë‚´ ì§€ì ë²ˆí˜¸
#  3. WD     : í’í–¥ (16ë°©ìœ„)
#  4. WS     : í’ì† (m/s)
#  5. GST_WD : ëŒí’í–¥ (16ë°©ìœ„)
#  6. GST_WS : ëŒí’ì† (m/s)
#  7. GST_TM : ëŒí’ì†ì´ ê´€ì¸¡ëœ ì‹œê° (ì‹œë¶„)
#  8. PA     : í˜„ì§€ê¸°ì•• (hPa)
#  9. PS     : í•´ë©´ê¸°ì•• (hPa)
# 10. PT     : ê¸°ì••ë³€í™”ê²½í–¥ (Code 0200) 
# 11. PR     : ê¸°ì••ë³€í™”ëŸ‰ (hPa)
# 12. TA     : ê¸°ì˜¨ (C)
# 13. TD     : ì´ìŠ¬ì ì˜¨ë„ (C)
# 14. HM     : ìƒëŒ€ìŠµë„ (%)
# 15. PV     : ìˆ˜ì¦ê¸°ì•• (hPa)
# 16. RN     : ê°•ìˆ˜ëŸ‰ (mm) : ì—¬ë¦„ì² ì—ëŠ” 1ì‹œê°„ê°•ìˆ˜ëŸ‰, ê²¨ìš¸ì² ì—ëŠ” 3ì‹œê°„ê°•ìˆ˜ëŸ‰
# 17. RN_DAY : ì¼ê°•ìˆ˜ëŸ‰ (mm) : í•´ë‹¹ì‹œê°„ê¹Œì§€ ê´€ì¸¡ëœ ì–‘(í†µê³„í‘œ)
# 18. RN_JUN : ì¼ê°•ìˆ˜ëŸ‰ (mm) : í•´ë‹¹ì‹œê°„ê¹Œì§€ ê´€ì¸¡ëœ ì–‘ì„ ì „ë¬¸ìœ¼ë¡œ ì…ë ¥í•œ ê°’(ì „ë¬¸)
# 19. RN_INT : ê°•ìˆ˜ê°•ë„ (mm/h) : ê´€ì¸¡í•˜ëŠ” ê³³ì´ ë³„ë¡œ ì—†ìŒ
# 20. SD_HR3 : 3ì‹œê°„ ì‹ ì ì„¤ (cm) : 3ì‹œê°„ ë™ì•ˆ ë‚´ë¦° ì‹ ì ì„¤ì˜ ë†’ì´
# 21. SD_DAY : ì¼ ì‹ ì ì„¤ (cm) : 00ì‹œ00ë¶„ë¶€í„° ìœ„ ê´€ì¸¡ì‹œê°„ê¹Œì§€ ë‚´ë¦° ì‹ ì ì„¤ì˜ ë†’ì´
# 22. SD_TOT : ì ì„¤ (cm) : ì¹˜ìš°ì§€ ì•Šê³  ê·¸ëƒ¥ ê³„ì† ìŒ“ì´ë„ë¡ ë†”ëˆˆ ê²½ìš°ì˜ ì ì„¤ì˜ ë†’ì´
# 23. WC     : GTS í˜„ì¬ì¼ê¸° (Code 4677)
# 24. WP     : GTS ê³¼ê±°ì¼ê¸° (Code 4561) .. 3(í™©ì‚¬),4(ì•ˆê°œ),5(ê°€ë‘ë¹„),6(ë¹„),7(ëˆˆ),8(ì†Œë‚˜ê¸°),9(ë‡Œì „)
# 25. WW     : êµ­ë‚´ì‹ ì¼ê¸°ì½”ë“œ (ë¬¸ìì—´ 22ê°œ) : 2ìë¦¬ì”© 11ê°œê¹Œì§€ ê¸°ë¡ ê°€ëŠ¥ (ì½”ë“œëŠ” ê¸°ìƒìì›ê³¼ ë¬¸ì˜)
# 26. CA_TOT : ì „ìš´ëŸ‰ (1/10)
# 27. CA_MID : ì¤‘í•˜ì¸µìš´ëŸ‰ (1/10)
# 28. CH_MIN : ìµœì €ìš´ê³  (100m)
# 29. CT     : ìš´í˜• (ë¬¸ìì—´ 8ê°œ) : 2ìë¦¬ ì½”ë“œë¡œ 4ê°œê¹Œì§€ ê¸°ë¡ ê°€ëŠ¥
# 30. CT_TOP : GTS ìƒì¸µìš´í˜• (Code 0509)
# 31. CT_MID : GTS ì¤‘ì¸µìš´í˜• (Code 0515)
# 32. CT_LOW : GTS í•˜ì¸µìš´í˜• (Code 0513)
# 33. VS     : ì‹œì • (10m)
# 34. SS     : ì¼ì¡° (hr)
# 35. SI     : ì¼ì‚¬ (MJ/m2)
# 36. ST_GD  : ì§€ë©´ìƒíƒœ ì½”ë“œ (ì½”ë“œëŠ” ê¸°ìƒìì›ê³¼ ë¬¸ì˜)
# 37. TS     : ì§€ë©´ì˜¨ë„ (C)
# 38. TE_005 : 5cm ì§€ì¤‘ì˜¨ë„ (C)
# 39. TE_01  : 10cm ì§€ì¤‘ì˜¨ë„ (C)
# 40. TE_02  : 20cm ì§€ì¤‘ì˜¨ë„ (C)
# 41. TE_03  : 30cm ì§€ì¤‘ì˜¨ë„ (C)
# 42. ST_SEA : í•´ë©´ìƒíƒœ ì½”ë“œ (ì½”ë“œëŠ” ê¸°ìƒìì›ê³¼ ë¬¸ì˜)
# 43. WH     : íŒŒê³  (m) : í•´ì•ˆê´€ì¸¡ì†Œì—ì„œ ëª©ì¸¡í•œ ê°’
# 44. BF     : Beaufart ìµœëŒ€í’ë ¥(GTSì½”ë“œ)
# 45. IR     : ê°•ìˆ˜ìë£Œ ìœ ë¬´ (Code 1819) .. 1(Sec1ì— í¬í•¨), 2(Sec3ì— í¬í•¨), 3(ë¬´ê°•ìˆ˜), 4(ê²°ì¸¡)
# 46. IX     : ìœ ì¸ê´€ì¸¡/ë¬´ì¸ê´€ì¸¡ ë° ì¼ê¸° í¬í•¨ì—¬ë¶€ (code 1860) .. 1,2,3(ìœ ì¸) 4,5,6(ë¬´ì¸) / 1,4(í¬í•¨), 2,5(ìƒëµ), 3,6(ê²°ì¸¡)
#--------------------------------------------------------------------------------------------------
```

- í¬ê¸° ì˜ˆìƒ: í•˜ë£¨ ë‹¹ ì•½ 10KB

</details>

<details>
<summary> Spotify ê³¡ ë°ì´í„° </summary>

### 1. Spotify Top 200 ê³¡ ì •ë³´ csv íŒŒì¼ ë‹¤ìš´ (with Selenium)
    
- ë§í¬: [https://charts.spotify.com/charts/view/regional-kr-daily/](https://charts.spotify.com/charts/view/regional-kr-daily/2025-04-10)<YYYY-MM-DD>
- csv íŒŒì¼ ì •ë³´
    
    <img width="691" alt="á„€á…©á†¨csv" src="https://github.com/user-attachments/assets/51d3d356-406c-44cf-ba0d-4798698cc3aa" />

    
- í¬ê¸° ì˜ˆìƒ: í•˜ë£¨ ë‹¹ ì•½ 20KB
    
### 2. Tunebatì—ì„œ 1ë²ˆì—ì„œ ì–»ì€ track_idë¥¼ ì´ìš©í•˜ì—¬ ê³¡ ì •ë³´ í¬ë¡¤ë§ (with Selenium)

- ë§í¬: https://tunebat.com/Info/a/<TRACK_ID>
- Spotify audio-featrues API ì§€ì› ì¤‘ë‹¨ì— ë”°ë¼,
ë‹¤ìŒ ì‚¬ì´íŠ¸ì˜ urlì— Spotify ê³¡ì˜ track_idë¥¼ ì¶”ê°€í•˜ì—¬ ì¡°íšŒ
- ì €ì¥í•  ë°ì´í„° ì •ë³´
    
```json
{
    "track_id": <track_id>,
    "bpm": <bpm>,
    "energy": <energy>,
    "danceability": <danceability>
}
```
    
- í¬ê¸° ì˜ˆìƒ: í•˜ë£¨ ë‹¹ ì•½ 100B

</details>

<br>
    
#  ğŸ§º Storage

> GCS ë²„í‚·
> 

```bash
bucket/
â”œâ”€â”€ raw/                         â† ğŸ“¥ API/í¬ë¡¤ë§ ì›ë³¸ ì €ì¥ì†Œ
â”‚   â”œâ”€â”€ weather_raw/
â”‚   â”‚   â””â”€â”€ partition: date
â”‚   â”‚   â””â”€â”€ íŒŒì¼ëª… í˜•ì‹: weather_raw/weather_raw-*.csv       (ì˜ˆ: weather_raw-20250401.csv)
â”‚   â”‚
â”‚   â””â”€â”€ songs_raw/
â”‚       â””â”€â”€ partition: date
â”‚       â””â”€â”€ íŒŒì¼ëª… í˜•ì‹: songs_raw/*.csv                    (ì˜ˆ: 2025-04-16.csv)
â”‚
â”œâ”€â”€ data/                        â† ğŸ§¹ ì „ì²˜ë¦¬ ì™„ë£Œëœ ë¶„ì„ ë°ì´í„°
â”‚   â”œâ”€â”€ weather_data/            â† ğŸŒ¦ï¸ í‰ê· ê¸°ì˜¨, ë²”ì£¼í™” ë“± ì •ì œ ë‚ ì”¨
â”‚   â”‚   â””â”€â”€ partition: dt=YYYYMMDD
â”‚   â”‚   â””â”€â”€ íŒŒì¼ëª… í˜•ì‹: part-*.parquet                     (ì˜ˆ: dt=20250402/part-00000-xxxx.parquet)
â”‚   â”‚
â”‚   â”œâ”€â”€ songs_top200/            â† ğŸµ ì •ì œëœ Top200 (track_id í¬í•¨)
â”‚   â”‚   â””â”€â”€ partition: dt=YYYYMMDD
â”‚   â”‚   â””â”€â”€ íŒŒì¼ëª… í˜•ì‹: part-*.parquet                     (ì˜ˆ: dt=20250402/part-00000-xxxx.parquet)
â”‚   â”‚
â”‚   â””â”€â”€ audio_features/          â† ğŸ§ Tunebatì—ì„œ ì¶”ì¶œí•œ ê³¡ íŠ¹ì„±
â”‚       â””â”€â”€ partition: ì—†ìŒ (track_id ë‹¨ìœ„ ì €ì¥)
â”‚       â””â”€â”€ íŒŒì¼ëª… í˜•ì‹: <track_id>.parquet                (ì˜ˆ: 7yZD4AVfQtAZD4cG8eRnPk.parquet)
â”‚
â”œâ”€â”€â”€ meta/                        â† ğŸ§  ë‚ ì§œ, ë‚ ì”¨, ê¸°ì˜¨ë³„ ê³¡ì— ëŒ€í•œ ì •ë³´ (ë…¸ì´ì¦ˆ ì œê±° ì™„ë£Œ)
â”‚   â””â”€â”€ meta_profile/
â”‚       â””â”€â”€ partition: dt=YYYYMMDD
â”‚       â””â”€â”€ subpartition: weather_code=N/temp_code=M
â”‚       â””â”€â”€ íŒŒì¼ëª… í˜•ì‹: part-*.parquet                    (ì˜ˆ: weather_code=0/temp_code=1/part-00000-80ead385-8190-4afe-8765-a3b0e975330a.c000.snappy.parquet))
â”‚
â””â”€â”€ tmp/                         â† ì¶”ì²œ ê³¡ ì •ë³´
    â””â”€â”€ recommend/
        â””â”€â”€ íŒŒì¼ëª… í˜•ì‹: json (ì˜ˆ: recommend_20230101.json)
```

<br>

# ğŸ“¦ ë°ì´í„° êµ¬ì„± ì•ˆë‚´

## 1. Raw ë°ì´í„°

### ğŸŸ¡ 1.1 ë‚ ì”¨ ì›ë³¸ (`raw/weather_raw/`)
- ìˆ˜ì§‘ ìœ„ì¹˜: `gs://jacob_weathertunes/raw/weather_raw/`
- ìˆ˜ì§‘ ë°©ì‹: ê¸°ìƒì²­ OpenAPI
- íŒŒí‹°ì…˜: `dt=YYYYMMDD`
- ì»¬ëŸ¼: API ì‘ë‹µ ì „ì²´ í¬í•¨ (TA, RN, SD_DAY, CA_TOT ë“± í¬í•¨ ê°€ëŠ¥)
- íŠ¹ì§•: ì›ë³¸ ìˆ˜ì§‘ìš©, ìŠ¤í‚¤ë§ˆ ê³ ì •ë˜ì§€ ì•ŠìŒ
```
+------------+---+---+---+------+------+------+-----+------+----+----+----+----+----+----+----+------+------+------+------+------+------+----+----+----+------+------+------+----+------+------+------+----+----+----+-----+----+------+-----+-----+-----+------+----+----+----+----+
|         _c0|_c1|_c2|_c3|   _c4|   _c5|   _c6|  _c7|   _c8| _c9|_c10|_c11|_c12|_c13|_c14|_c15|  _c16|  _c17|  _c18|  _c19|  _c20|  _c21|_c22|_c23|_c24|  _c25|  _c26|  _c27|_c28|  _c29|  _c30|  _c31|_c32|_c33|_c34| _c35|_c36|  _c37| _c38| _c39| _c40|  _c41|_c42|_c43|_c44|_c45|
+------------+---+---+---+------+------+------+-----+------+----+----+----+----+----+----+----+------+------+------+------+------+------+----+----+----+------+------+------+----+------+------+------+----+----+----+-----+----+------+-----+-----+-----+------+----+----+----+----+
|          TM|STN| WD| WS|GST_WD|GST_WS|GST_TM|   PA|    PS|  PT|  PR|  TA|  TD|  HM|  PV|  RN|RN_DAY|RN_JUN|RN_INT|SD_HR3|SD_DAY|SD_TOT|  WC|  WP|  WW|CA_TOT|CA_MID|CH_MIN|  CT|CT_TOP|CT_MID|CT_LOW|  VS|  SS|  SI|ST_GD|  TS|TE_005|TE_01|TE_02|TE_03|ST_SEA|  WH|  BF|  IR|  IX|
|202308100000|108|  7|3.9|     7|  10.0|  2244|993.4|1003.1|   8|-0.5|25.1|21.8|82.0|26.1| 0.2|   0.2|   0.2|  NULL|  NULL|  NULL|  NULL|  60|  66|   1|    10|     5|    17|ScAs|  NULL|     2|     5|2000|NULL|NULL| NULL|24.3|  28.7| 28.9| 28.4| 28.4|  NULL|NULL|NULL|   4|   1|
|202308100100|108|  7|4.4|     7|  10.0|     6|992.3|1002.0|NULL|NULL|24.9|21.4|81.0|25.5| 0.0|   0.0|   0.0|  NULL|  NULL|  NULL|  NULL|  60|  66|   1|    10|     5|    17|ScAs|  NULL|     2|     5|2000|NULL|NULL| NULL|23.8|  28.3| 28.6| 28.2| 28.3|  NULL|NULL|NULL|   4|   1|
|202308100200|108|  5|3.0|  NULL|  NULL|  NULL|991.6|1001.2|NULL|NULL|24.7|21.6|83.0|25.8| 0.0|   0.0|   0.0|  NULL|  NULL|  NULL|  NULL|  60|  66|   1|    10|     3|    17|ScAs|  NULL|     2|     5|2000|NULL|NULL| NULL|23.9|  28.1| 28.4| 28.0| 28.2|  NULL|NULL|NULL|   4|   1|
|202308100300|108|  5|3.0|     7|  10.0|  2244|991.2|1000.8|   7|-2.3|24.2|21.3|84.0|25.3| 0.0|   0.0|   0.0|  NULL|  NULL|  NULL|  NULL|  60|  66|   1|    10|     4|    17|ScAs|  NULL|     2|     5|2000|NULL|NULL| NULL|23.6|  27.9| 28.2| 27.9| 28.2|  NULL|NULL|NULL|   4|   1|
|202308100400|108|  5|2.6|  NULL|  NULL|  NULL|990.9|1000.5|NULL|NULL|23.7|21.2|86.0|25.2| 0.3|   0.3|   0.3|  NULL|  NULL|  NULL|  NULL|  60|  66|   1|    10|     6|    15|ScAs|  NULL|     2|     5|2000|NULL|NULL| NULL|23.5|  27.7| 28.0| 27.7| 28.1|  NULL|NULL|NULL|   4|   1|
|202308100500|108|  5|4.6|  NULL|  NULL|  NULL|990.6|1000.3|NULL|NULL|23.1|21.1|89.0|25.0| 1.2|   1.5|   1.5|  NULL|  NULL|  NULL|  NULL|  61|  66|   1|    10|     7|    10|StNs|  NULL|     2|     7|1812|NULL|NULL| NULL|23.1|  27.4| 27.8| 27.6| 28.0|  NULL|NULL|NULL|   4|   1|
|202308100600|108|  5|3.5|     5|  10.0|   521|990.1| 999.8|   7|-1.0|22.8|20.7|88.0|24.4| 0.6|   2.1|   2.1|  NULL|  NULL|  NULL|  NULL|  61|  66|   1|    10|     7|    10|StNs|  NULL|     2|     7|2000| 0.0| 0.0| NULL|22.7|  27.1| 27.6| 27.4| 27.9|  NULL|NULL|NULL|   4|   1|
|202308100700|108|  7|2.5|  NULL|  NULL|  NULL|990.0| 999.7|NULL|NULL|22.9|20.7|88.0|24.4| 0.2|   2.3|   2.3|  NULL|  NULL|  NULL|  NULL|  61|  66|   1|    10|     7|    10|StNs|  NULL|     2|     7|2000| 0.0|0.03| NULL|23.1|  26.9| 27.3| 27.3| 27.8|  NULL|NULL|NULL|   4|   1|
|202308100800|108|  5|1.8|  NULL|  NULL|  NULL|990.0| 999.7|NULL|NULL|22.9|20.9|89.0|24.7| 1.7|   4.0|   4.0|  NULL|  NULL|  NULL|  NULL|  61|  66|   1|    10|     8|    10|StNs|  NULL|     2|     7|1023| 0.0|0.07| NULL|23.6|  26.8| 27.2| 27.1| 27.7|  NULL|NULL|NULL|   4|   1|
+------------+---+---+---+------+------+------+-----+------+----+----+----+----+----+----+----+------+------+------+------+------+------+----+----+----+------+------+------+----+------+------+------+----+----+----+-----+----+------+-----+-----+-----+------+----+----+----+----+
```

### ğŸŸ¢ 1.2 ê³¡ ì›ë³¸ (`raw/songs_raw/`)
- ìˆ˜ì§‘ ìœ„ì¹˜: `gs://jacob_weathertunes/raw/songs_raw/`
- ìˆ˜ì§‘ ë°©ì‹: Playwright + Spotify Charts
- íŒŒí‹°ì…˜: `dt=YYYYMMDD`
- ì»¬ëŸ¼: ë‚ ì§œ, ì•„í‹°ìŠ¤íŠ¸ëª…, íŠ¸ë™ëª…, ë­í‚¹, ìŠ¤íŠ¸ë¦¬ë° ìˆ˜ ë“± (í˜•íƒœ ë³€ê²½ ê°€ëŠ¥)
- íŠ¹ì§•: ì°¨íŠ¸ CSV êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ì €ì¥
```
+----+--------------------+--------------------+--------------------+--------------------+---------+-------------+-------------+-------+
| _c0|                 _c1|                 _c2|                 _c3|                 _c4|      _c5|          _c6|          _c7|    _c8|
+----+--------------------+--------------------+--------------------+--------------------+---------+-------------+-------------+-------+
|rank|                 uri|        artist_names|          track_name|              source|peak_rank|previous_rank|days_on_chart|streams|
|   1|spotify:track:3r8...|            NewJeans|               Ditto|                ADOR|        1|            1|           14|  75985|
|   2|spotify:track:0a4...|            NewJeans|            Hype Boy|                ADOR|        1|            2|          154|  34202|
|   3|spotify:track:4fs...|         LE SSERAFIM|         ANTIFRAGILE|        SOURCE MUSIC|        1|            3|           77|  26620|
|   4|spotify:track:6RB...|              Younha|       Event Horizon|    C9 Entertainment|        1|            4|           96|  23102|
|   5|spotify:track:2pI...|            NewJeans|           Attention|                ADOR|        1|            5|          154|  21934|
|   6|spotify:track:27b...|           NCT DREAM|               Candy|    SM Entertainment|        1|            6|           17|  20167|
|   7|spotify:track:1RD...|Jung Kook, BTS, F...|Dreamers [Music f...|Katara Studios | ...|        1|            7|           44|  19609|
|   8|spotify:track:2gY...|                 IVE|          After LIKE|Starship Entertai...|        1|            8|          133|  17484|
|   9|spotify:track:5Od...|Charlie Puth, Jun...|Left and Right (F...|    Atlantic Records|        1|           10|          192|  16952|
+----+--------------------+--------------------+--------------------+--------------------+---------+-------------+-------------+-------+
```
---

## 2. ì •ì œ ë°ì´í„° (Processed)

### ğŸ”µ 2.1 ì •ì œëœ ë‚ ì”¨ (`data/weather_daily/`)
- ìˆ˜ì§‘ ìœ„ì¹˜: `gs://jacob_weathertunes/data/weather_daily/`
- ì „ì²˜ë¦¬ ë°©ì‹: ê¸°ì˜¨ í‰ê·  ë° ë‚ ì”¨/ê¸°ì˜¨ ì½”ë“œ ë¶€ì—¬
- ì£¼ìš” ì»¬ëŸ¼: dt, temperature_avg, weather_code, temp_code
```
+------------+---------+--------+
|weather_code|temp_code|      dt|
+------------+---------+--------+
|           0|        0|20230104|
|           2|        4|20230714|
|           0|        1|20230223|
|           2|        5|20230727|
|           2|        0|20231217|
|           0|        0|20240127|
|           2|        4|20230830|
|           2|        1|20240220|
|           3|        0|20231224|
|           0|        4|20230603|
+------------+---------+--------+
```
### ğŸŸ£ 2.2 ì •ì œëœ Top200 (`data/songs_top200/`)
- ìˆ˜ì§‘ ìœ„ì¹˜: `gs://jacob_weathertunes/data/songs_top200/`
- ì£¼ìš” ì»¬ëŸ¼: track_id, artist_names, track_name, streams, days_on_chart
- ê¸°ì¤€: Spotify ê¸°ì¤€ í•˜ë£¨ ë‹¨ìœ„ Top 200
  
```
+--------------------+--------------------+--------------------+-------------+-------+--------+
|            track_id|        artist_names|          track_name|days_on_chart|streams|      dt|
+--------------------+--------------------+--------------------+-------------+-------+--------+
|3r8RuvgbX9s7ammBn...|            NewJeans|               Ditto|           25|  84117|20230112|
|65FftemJ1DbbZ45DU...|            NewJeans|                 OMG|           11|  79214|20230112|
|0a4MMyCrzT0En247I...|            NewJeans|            Hype Boy|          165|  36789|20230112|
|2pIUpMhHL6L9Z5lnK...|            NewJeans|           Attention|          165|  25927|20230112|
|4fsQ0K37TOXa3hEQf...|         LE SSERAFIM|         ANTIFRAGILE|           88|  24301|20230112|
|1Qrg8KqiBpW07V7PN...|                 SZA|           Kill Bill|           35|  20321|20230112|
|27bIik73QCu8Xzt3x...|           NCT DREAM|               Candy|           28|  18926|20230112|
|6RBziRcDeiho3iTPd...|              Younha|       Event Horizon|          107|  18707|20230112|
|1RDvyOk4WtPCtoqci...|Jung Kook, BTS, F...|Dreamers [Music f...|           55|  18279|20230112|
|5Odq8ohlgIbQKMZiv...|Charlie Puth, Jun...|Left and Right (F...|          203|  17484|20230112|
+--------------------+--------------------+--------------------+-------------+-------+--------+
```

### ğŸŸ¤ 2.3 ì˜¤ë””ì˜¤ í”¼ì²˜ (`data/audio_features/`)
- ìˆ˜ì§‘ ìœ„ì¹˜: `gs://jacob_weathertunes/data/audio_features/`
- ìˆ˜ì§‘ ë°©ì‹: Tunebat + Selenium í¬ë¡¤ë§
- ì£¼ìš” ì»¬ëŸ¼: track_id, BPM, Danceability, Happiness
```
+--------------------+---+------------+---------+
|            track_id|BPM|Danceability|Happiness|
+--------------------+---+------------+---------+
|008hCrBLW4a7BbC6c...|155|          67|       38|
|00Apys6jYrWA0Bse9...|110|          63|       29|
|0139mjI8ijLp4SYOG...|140|          76|       66|
|01d3IKaDzqxP50zPZ...| 94|          51|       37|
|01nC1XQoc7jqWDJdv...|150|          37|       36|
|01qFKNWq73UfEslI0...|108|          85|       89|
|02H58MSfVESkKyx4d...| 88|          77|       34|
|02MWAaffLxlfxAUY7...| 81|          76|       53|
|02U9EixxU2Znl6ils...|108|          83|       38|
|02VBYrHfVwfEWXk5D...|148|          59|       72|
+--------------------+---+------------+---------+
```

---

## 3. ë©”íƒ€ë°ì´í„° (`meta/meta_profile/`)

- ì €ì¥ ìœ„ì¹˜: `gs://jacob_weathertunes/meta/dt=YYYYMMDD/weather_code=N/temp_code=M/`
- ì£¼ìš” ì»¬ëŸ¼: track_id, artist_names, track_name, streams, BPM, Danceability, Happiness, dt, weather_code, temp_code
```
+--------------------+--------------------+--------------------+-------+---+------------+---------+--------+------------+---------+
|            track_id|        artist_names|          track_name|streams|BPM|danceability|happiness|      dt|weather_code|temp_code|
+--------------------+--------------------+--------------------+-------+---+------------+---------+--------+------------+---------+
|51vRumtqbkNW9wrKf...|LE SSERAFIM, Nile...|UNFORGIVEN (feat....|  60448|104|          80|       38|20230503|           1|        3|
|70t7Q6AYG6ZgTYmJW...|                 IVE|                I AM|  49756|122|          68|       38|20230503|           1|        3|
|3AOf6YEpxQ894Fmrw...|           SEVENTEEN|               Super|  27278|137|          77|       35|20230503|           1|        3|
|7ovUcF5uHTBRzUpB6...|             YOASOBI|            ã‚¢ã‚¤ãƒ‰ãƒ«|  22317|166|          57|       84|20230503|           1|        3|
|4bjN59DRXFRxBE1g5...|             Agust D|             Haegeum|  20270| 85|          70|       83|20230503|           1|        3|
|6DSGb5CmwHX4pvclq...|         LE SSERAFIM|No-Return (Into t...|  15963|158|          75|       95|20230503|           1|        3|
|4QhnNyKDsAkXPwHkS...|         LE SSERAFIM|Eve, Psyche & The...|  15579|143|          66|       63|20230503|           1|        3|
|0jd4aa9XgV5eom0ez...|       NCT DOJAEJUNG|             Perfume|  15515|106|          72|       70|20230503|           1|        3|
|41JPN7pZMTp1sumBO...|         Agust D, IU|People Pt.2 (feat...|  14877| 89|          73|       44|20230503|           1|        3|
|6qVqWJxIpsabUKBIL...|        aespa, nÃ¦vis|Welcome To MY Wor...|  13378|152|          60|       37|20230503|           1|        3|
+--------------------+--------------------+--------------------+-------+---+------------+---------+--------+------------+---------+
```

# ğŸ”„ ë°ì´í„° íŒŒì´í”„ë¼ì¸

![pipeline](https://github.com/user-attachments/assets/a4440711-9b1c-483b-8d05-269733b0dca4)


<br>

---

# ğŸ¤ ë…¸ì´ì¦ˆ 

> ë‚ ì”¨ë‘ ìƒê´€ì—†ì´ í•­ìƒ Top 200ì— ìˆëŠ” `í•­ìƒ ì¸ê¸° ìˆëŠ” ê³¡(=ë…¸ì´ì¦ˆ)`ì€ ë¶„ì„ì— ë°©í•´ê°€ ëœë‹¤.  
â†’ `ê¸°ì €íš¨ê³¼(baseline effect)` ë˜ëŠ” `ìŠ¤í…Œë””ì…€ëŸ¬ ë…¸ì´ì¦ˆ`ë¼ê³  ë¶ˆë¦¼

## ğŸš¯ ë…¸ì´ì¦ˆ ì œê±° êµ¬ë¶„ (ì„ì‹œ)

```python
df_filtered = df[df["days_on_chart"] < 30].reset_index(drop=True) # 30ì¼ ì´ìƒ ê³¡ë“¤ì€ ì œì™¸
```

| í•„ë“œëª… | ë‚´ìš© | í™œìš© |
| --- | --- | --- |
| days_on_chart | ì°¨íŠ¸ ëˆ„ì  ì§„ì…ì¼ìˆ˜ | ë…¸ì´ì¦ˆ ì œê±° ê¸°ì¤€ |

<br>

# ğŸŒ¤ï¸ ë‚ ì”¨ êµ¬ë¶„

í•„ìš” ì •ë³´: ê¸°ì˜¨, ì „ìš´ëŸ‰, ê°•ìˆ˜ëŸ‰, ì‹ ì ì„¤

- ê¸°ì¤€ í•„ë“œ

| í•„ë“œëª… | ë‚´ìš© | í™œìš© |
| --- | --- | --- |
| CA_TOT | ì „ìš´ëŸ‰ (0~10) | â˜€ï¸Â ë§‘ìŒ / â˜ï¸Â íë¦¼ êµ¬ë¶„ |
| RN, RN_DAY | ê°•ìˆ˜ëŸ‰ (mm) | ğŸŒ§ï¸Â ë¹„ íŒë‹¨ ê¸°ì¤€ |
| SD_DAY, SD_HR3 | ì ì„¤ëŸ‰ (cm) | â„ï¸Â ëˆˆ íŒë‹¨ ê¸°ì¤€ |

- ë‚ ì”¨ êµ¬ë¶„ ì½”ë“œ

| ë‚ ì”¨ | ì½”ë“œ |
| --- | --- |
| ë§‘ìŒ | 0 |
| íë¦¼ | 1 |
| ë¹„ | 2 |
| ëˆˆ | 3 |

- ê¸°ì˜¨ êµ¬ë¶„ ì½”ë“œ

| ê¸°ì˜¨ | ì½”ë“œ |
| --- | --- |
| 0ë„ ì´í•˜ | 0 |
| 0 - 10ë„ | 1 |
| 10 - 15ë„ | 2 |
| 15 - 20ë„ | 3 |
| 20 - 25ë„ | 4 |
| 25ë„ ì´ìƒ | 5 |

---

# ğŸ¼ ì¶”ì²œ ê³¡ ì•Œê³ ë¦¬ì¦˜

1. parquetì—ì„œ ê³¡ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
2. í‰ê· ê°’ ë° í‘œì¤€í¸ì°¨ ê³„ì‚°
3. z-score ë°©ì‹ìœ¼ë¡œ ìœ ì‚¬ë„ êµ¬í•˜ê¸°
4. ê°€ì¥ ìœ ì‚¬í•œ ê³¡ Top 5 ì¶”ì¶œ

---

# ğŸ“– ì˜ˆìƒ ì‹œë‚˜ë¦¬ì˜¤

ë¹„ê°€ ì˜¤ëŠ” ë‚  (weather=2), ê¸°ì˜¨ 5â„ƒ (temp=1) í‰ê· 

- BPM: 94.5
- Energy: 56
- Danceability: 54.75

ë§‘ì€ ë‚  (weather=0), ê¸°ì˜¨ -3â„ƒ(temp=0) í‰ê· 

- BPM: 111
- Energy: 69.5
- Danceability: 75.75

ë‚ ì”¨ê°€ ë¹„, ê¸°ì˜¨ì´ 5â„ƒì¸ ê²½ìš°,
`meta/weather=2/temp=1/*.parquet` ë°ì´í„°ë¥¼ í†µí•´ ì¶”ì²œ ê³¡ ì•Œê³ ë¦¬ì¦˜ì„ ì‹¤í–‰í•˜ì—¬ í‰ê· ì¹˜ì™€ ë¹„ìŠ·í•œ ê³¡ë“¤ì„ ì¶”ì²œ


# ğŸ” ì‘ì—… íë¦„
![image](https://github.com/user-attachments/assets/b7aff9c5-2014-4811-936b-c9dc86e5235f)

- Raw ë°ì´í„° ìˆ˜ì§‘
- ì „ì²˜ë¦¬/ë°ì´í„° íŒŒí‹°ì…”ë‹
- Airflow
    - discord ë©”ì„¸ì§€ ì˜ˆì‹œ(airflow ë§ˆì§€ë§‰ ë‹¨ê³„) (ë‚ ì”¨ì •ë³´ , ê³¡ ì¶”ì²œ)
      
![image](https://github.com/user-attachments/assets/efd050b8-294a-42af-8235-a12f510ace01)


## âš’ï¸ DAG ì„¤ê³„

### raw_weather

- start >> fetch_today_weather >> end

### raw_songs

- start >> scrape_today_top200 >> end

### data_weather

- start >> clean_weather_data >> end

### data_songs

- start >> clean_songs_top200 >> end

### data_audio_features

- start >> scrape_audio_features >> end

### meta

- start >> generate_meta_profile >> copy_to_bigquery >> end

### Recommendation

- start >> load_recommened_songs >> send_nofitication >> end

# ğŸŒ¿ Git ë¸Œëœì¹˜ ì „ëµ

> ê¸°ëŠ¥ ë‹¨ìœ„ë¡œ ë‚˜ëˆ  ê°œë°œë˜ë©°, `0.1/develop` ë¸Œëœì¹˜ì— í†µí•©ë©ë‹ˆë‹¤.

| ë¸Œëœì¹˜ëª…                    | ì„¤ëª… |
|-----------------------------|------|
| `0.1/develop`               | ì „ì²´ í†µí•© ê°œë°œ ë¸Œëœì¹˜ |
| `0.1/feature-data_weather`  | ê¸°ìƒì²­ ë‚ ì”¨ ë°ì´í„° ìˆ˜ì§‘ ë° ì „ì²˜ë¦¬ |
| `0.1/feature-raw_songs`     | Spotify Top 200 ê³¡ ìˆ˜ì§‘ |
| `0.1/feature-data_songs`    | Spotify Top 200 ê³¡ ì „ì²˜ë¦¬|
| `0.1/feature-data_songs`    | Tunebat ì—ì„œ audio featìˆ˜ì§‘|
| `0.1/features-meta`         | ë‚ ì”¨+ê³¡ ê²°í•© ë©”íƒ€ë°ì´í„° ìƒì„± |
| `0.1/features-recommendation` | ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ ê°œë°œ ë° ì‹œê°í™” ì—°ë™ |

> ë¸Œëœì¹˜ ë³‘í•©ì€ PR(Pull Request)ì„ í†µí•´ ë‹¨ê³„ì ìœ¼ë¡œ ë¦¬ë·° í›„ ìˆ˜í–‰ë©ë‹ˆë‹¤.
